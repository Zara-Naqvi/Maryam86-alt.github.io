<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaheer Abbas | Deputy IT Manager</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Google Fonts: Playfair Display for the name, Inter for everything else -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to apply the specific fonts and aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7; /* Very light gray background */
            min-height: 100vh;
        }

        .header-name {
            font-family: 'Playfair Display', serif;
            letter-spacing: 0.05em;
        }

        /* Utility for the subtle shadow/glow on cards and buttons */
        .soft-card {
            background-color: rgba(220, 220, 220, 0.8); /* Light gray with slight transparency */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(2px);
        }

        .nav-button {
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-button:hover {
            background-color: rgba(189, 189, 189, 0.9);
            transform: translateY(-2px);
        }

        .profile-img-container {
            /* Mimics the slight shadow/border effect in the original image */
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.8), 0 0 10px rgba(0, 0, 0, 0.2);
            padding: 2px;
            background-color: white;
        }
        
        /* Ensure strong text is visibly bold */
        .soft-card strong {
            font-weight: 700;
        }
        
        /* Transition for the video link hover effect */
        #video-link {
            transition: color 0.2s;
        }
        #video-link:hover .text-gray-700 {
            color: #4a5568; /* Darker gray on hover */
        }
        #video-link:hover .bg-gray-500 {
            background-color: #4a5568;
        }

        /* Spinning animation for loading */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex justify-center items-start">

    <!-- Main Content Container -->
    <div class="w-full max-w-4xl text-center">

        <!-- 1. Header Name -->
        <h1 class="header-name text-7xl sm:text-8xl font-medium text-gray-800 mt-8 mb-4">
            Zaheer Abbas
        </h1>

        <!-- 2. Profile Image & Video Icon Container (Flex to align icon and image horizontally) -->
        <div class="flex justify-center items-center mb-10">
            
            <!-- Video Play Icon Link (Now functional) -->
            <a href="#" id="video-link" class="flex items-center w-24 sm:w-32 mr-4 justify-end cursor-pointer">
                
                <!-- Loading/Play Icon Container -->
                <div id="video-icon-container" class="order-2 transition-colors duration-200">
                    <!-- Default Play Icon (Visible when audio is ready) -->
                    <svg id="play-icon" class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.799v4.394a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <!-- Loading Spinner (Visible while audio is pre-loading) -->
                    <svg id="loading-spinner" class="hidden w-6 h-6 text-gray-500 animate-spin-slow" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </div>

                <!-- Horizontal Line -->
                <div class="flex-grow h-px bg-gray-500 order-1 mr-2 transition-colors duration-200"></div>
            </a>

            <!-- Profile Image Container -->
            <div class="profile-img-container rounded-full overflow-hidden w-40 h-40">
                <!-- IMAGE SOURCE UPDATED TO profile.jpg -->
                <img 
                    src="profile.jpg" 
                    alt="Zaheer Abbas Profile" 
                    class="object-cover w-full h-full"
                    onerror="this.onerror=null;this.src='https://placehold.co/160x160/374151/ffffff?text=Profile+Error';"
                >
            </div>

            <!-- Placeholder for right side symmetry (empty space) -->
            <div class="w-24 sm:w-32 ml-4"></div>
        </div>

        <!-- 3. Job Title -->
        <h2 class="text-xl sm:text-2xl font-bold tracking-widest text-gray-700 mb-10">
            DEPUTY IT MANAGER FOR INFRASTRUCTURE
        </h2>

        <!-- 4. About Section (The main card) -->
        <div class="soft-card p-6 sm:p-10 rounded-3xl mx-auto max-w-3xl mb-12">
            <p id="profile-bio" class="text-gray-700 text-sm sm:text-base leading-relaxed">
                Hello, I am <strong>Zaheer Abbas</strong>. As a seasoned Deputy IT Manager for Infrastructure with over 14 years of experience, I leverage my expertise in managing complex IT environments to drive innovation and excellence in higher education and public sectors. With a strong background in <strong>Linux systems, virtualization technologies, and networking</strong>, I excel in leading data center operations, infrastructure planning, and service delivery while prioritizing automation, resilience, and compliance. Currently serving at the <strong>University of Oxford</strong>, I bring technical leadership and strategic vision to the table, supported by professional certifications including PRINCE2, ITIL, RHCSA, and CEH.
            </p>
        </div>

        <!-- 5. "Know more about me" Heading -->
        <h3 class="text-xl sm:text-2xl font-semibold text-gray-800 mb-8 mt-12">
            Know more about me
        </h3>

        <!-- 6. Navigation Buttons -->
        <div class="flex flex-wrap justify-center gap-4 sm:gap-6 px-4 mb-16">
            <button id="skills-btn" class="nav-button soft-card text-xs sm:text-sm font-bold uppercase tracking-wider text-gray-700 py-3 px-6 rounded-full">
                Key Skills & Tools
            </button>
            <button id="certs-btn" class="nav-button soft-card text-xs sm:text-sm font-bold uppercase tracking-wider text-gray-700 py-3 px-6 rounded-full">
                Certifications & Trainings
            </button>
            <button id="work-btn" class="nav-button soft-card text-xs sm:text-sm font-bold uppercase tracking-wider text-gray-700 py-3 px-6 rounded-full">
                Work Experience
            </button>
            <button id="edu-btn" class="nav-button soft-card text-xs sm:text-sm font-bold uppercase tracking-wider text-gray-700 py-3 px-6 rounded-full">
                Education
            </button>
        </div>

        <!-- 7. Contact Button -->
        <button id="contact-btn" class="nav-button soft-card text-base font-semibold text-gray-800 py-4 px-12 rounded-full mb-12">
            Contact Me
        </button>

        <!-- Message Box for simulating alerts and showing status -->
        <div id="message-box" class="fixed bottom-5 right-5 bg-gray-800 text-white p-4 rounded-lg shadow-2xl transition-opacity duration-300 opacity-0 pointer-events-none">
            Status: <span id="message-text"></span>
        </div>

    </div>

    <script>
        // === USER ACTION REQUIRED ===
        // To make the TTS function work on your live website (GitHub Pages), 
        // you MUST replace the placeholder below with your actual Gemini API Key.
        // Get your key from the Google AI Studio console.
        const USER_API_KEY = "YOUR_GEMINI_API_KEY_HERE"; 
        // If running in the Canvas environment, leave the key as the placeholder, 
        // and the environment will handle authentication.

        // --- Global State for Preloading ---
        let preloadedAudio = null;
        let isAudioReady = false;
        
        // DOM Elements
        const videoLink = document.getElementById('video-link');
        const playIcon = document.getElementById('play-icon');
        const loadingSpinner = document.getElementById('loading-spinner');
        const profileBioText = document.getElementById('profile-bio').textContent.replace(/\s+/g, ' ').trim(); // Get text and clean up whitespace

        // --- TTS Helper Functions (Same as before) ---
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcm16, sampleRate = 24000) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const blockAlign = numChannels * (bitsPerSample / 8);
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcm16.length * 2; 

            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            let offset = 0;
            function writeString(s) {
                for (let i = 0; i < s.length; i++) {
                    view.setUint8(offset++, s.charCodeAt(i));
                }
            }
            writeString('RIFF');
            view.setUint32(offset, 36 + dataSize, true); offset += 4;
            writeString('WAVE');
            writeString('fmt ');
            view.setUint32(offset, 16, true); offset += 4; 
            view.setUint16(offset, 1, true); offset += 2;  
            view.setUint16(offset, numChannels, true); offset += 2;
            view.setUint32(offset, sampleRate, true); offset += 4;
            view.setUint32(offset, byteRate, true); offset += 4;
            view.setUint16(offset, blockAlign, true); offset += 2;
            view.setUint16(offset, bitsPerSample, true); offset += 2;
            writeString('data');
            view.setUint32(offset, dataSize, true); offset += 4;

            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(offset, pcm16[i], true);
                offset += 2;
            }
            return new Blob([view], { type: 'audio/wav' });
        }
        // --- End TTS Helper Functions ---

        // Simple function to display a status message
        function showMessage(text, isError = false) {
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');

            messageText.textContent = text;
            messageBox.classList.remove('opacity-0', 'pointer-events-none', 'bg-red-600', 'bg-gray-800');
            
            messageBox.classList.add('opacity-100', isError ? 'bg-red-600' : 'bg-gray-800'); 

            // Auto-hide after 5 seconds unless it's an error
            if (!isError) {
                setTimeout(() => {
                    messageBox.classList.remove('opacity-100');
                    messageBox.classList.add('opacity-0', 'pointer-events-none');
                }, 5000);
            }
        }

        // 1. Function to pre-load the audio when the page loads
        async function preloadAudioIntroduction() {
            // Initial UI state: Disable link and show spinner
            videoLink.classList.add('opacity-50', 'pointer-events-none');
            playIcon.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            showMessage('Pre-loading audio introduction (reading full bio)...', false);

            const userPrompt = `Say in a confident, informative voice: ${profileBioText}`;
            
            // --- CRITICAL FIX: Include API Key if available, otherwise rely on environment ---
            let apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent`;
            
            if (USER_API_KEY && USER_API_KEY !== "YOUR_GEMINI_API_KEY_HERE") {
                // If the user has provided a key, use it for public deployment
                apiUrl += `?key=${USER_API_KEY}`;
            }

            const payload = {
                contents: [{ parts: [{ text: userPrompt }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: { prebuiltVoiceConfig: { voiceName: "Charon" } }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const maxRetries = 3;
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`API status ${response.status}: ${errorBody.error?.message || 'Unknown API Error'}`);
                    }

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                        const sampleRate = 24000;
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        // Store the ready-to-play Audio object
                        preloadedAudio = new Audio(audioUrl);
                        isAudioReady = true;

                        // Success UI state: Enable link and show play icon
                        videoLink.classList.remove('opacity-50', 'pointer-events-none');
                        loadingSpinner.classList.add('hidden');
                        playIcon.classList.remove('hidden');
                        showMessage('Audio Introduction Ready! Click to play.', false);
                        return; // Success, exit loop
                    } else {
                        throw new Error("Invalid audio response format received.");
                    }
                } catch (error) {
                    console.error(`TTS Preload attempt ${attempt + 1} failed:`, error.message);
                    if (attempt < maxRetries - 1) {
                        const delay = Math.pow(2, attempt) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay)); // Exponential backoff
                    } else {
                        // Final error message after all retries
                        showMessage(`Audio Preload Failed on your live site. Please ensure your API key is set in the code. Error: ${error.message}`, true);
                        loadingSpinner.classList.add('hidden');
                        playIcon.classList.remove('hidden'); 
                    }
                }
            }
        }

        // 2. Function to play the pre-loaded audio instantly on click
        function playIntroduction() {
            if (isAudioReady && preloadedAudio) {
                // Rewind the audio and play instantly
                preloadedAudio.currentTime = 0;
                preloadedAudio.play();
                showMessage('Playing full introduction instantly!', false);

                // Hide the message box when playback is complete
                preloadedAudio.onended = () => {
                    document.getElementById('message-box').classList.remove('opacity-100');
                    document.getElementById('message-box').classList.add('opacity-0', 'pointer-events-none');
                };
            } else {
                showMessage('Audio is still loading. Please wait a few seconds.', true);
            }
        }


        // --- Event Listeners ---
        document.getElementById('video-link').addEventListener('click', (e) => {
            e.preventDefault(); // Prevent page jump
            playIntroduction();
        });

        document.getElementById('skills-btn').addEventListener('click', () => {
            showMessage('Navigating to Key Skills & Tools section...');
        });
        document.getElementById('certs-btn').addEventListener('click', () => {
            showMessage('Navigating to Certifications & Trainings section...');
        });
        document.getElementById('work-btn').addEventListener('click', () => {
            showMessage('Navigating to Work Experience section...');
        });
        document.getElementById('edu-btn').addEventListener('click', () => {
            showMessage('Navigating to Education section...');
        });
        document.getElementById('contact-btn').addEventListener('click', () => {
            showMessage('Initiating Contact Me action...');
        });
        
        // --- Initialization: Start preloading the audio as soon as the window loads ---
        window.onload = function() {
            // Note: This function will run immediately, but if your API key is missing
            // the error message will be shown after a short delay.
            preloadAudioIntroduction();
        };

    </script>
</body>
</html>
